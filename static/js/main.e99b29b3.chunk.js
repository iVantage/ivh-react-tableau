/*! For license information please see main.e99b29b3.chunk.js.LICENSE.txt */
(this["webpackJsonpivh-react-tableau-example"]=this["webpackJsonpivh-react-tableau-example"]||[]).push([[0],[,,,,,function(e,t,r){e.exports=r(12)},function(e,t,r){},,,,,function(e,t,r){},function(e,t,r){"use strict";r.r(t);r(6);var s=r(0),a=r.n(s),o=r(3),i=r.n(o),n=r(4),c=r(1);function l(e,t){return e(t={exports:{}},t.exports),t.exports}var p="function"===typeof Symbol&&Symbol.for,h=p?Symbol.for("react.element"):60103,u=p?Symbol.for("react.portal"):60106,f=p?Symbol.for("react.fragment"):60107,d=p?Symbol.for("react.strict_mode"):60108,m=p?Symbol.for("react.profiler"):60114,b=p?Symbol.for("react.provider"):60109,y=p?Symbol.for("react.context"):60110,w=p?Symbol.for("react.async_mode"):60111,v=p?Symbol.for("react.concurrent_mode"):60111,g=p?Symbol.for("react.forward_ref"):60112,S=p?Symbol.for("react.suspense"):60113,O=p?Symbol.for("react.suspense_list"):60120,E=p?Symbol.for("react.memo"):60115,k=p?Symbol.for("react.lazy"):60116,P=p?Symbol.for("react.block"):60121,j=p?Symbol.for("react.fundamental"):60117,T=p?Symbol.for("react.responder"):60118,L=p?Symbol.for("react.scope"):60119;function z(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case h:switch(e=e.type){case w:case v:case f:case m:case d:case S:return e;default:switch(e=e&&e.$$typeof){case y:case g:case k:case E:case b:return e;default:return t}}case u:return t}}}function R(e){return z(e)===v}var C={AsyncMode:w,ConcurrentMode:v,ContextConsumer:y,ContextProvider:b,Element:h,ForwardRef:g,Fragment:f,Lazy:k,Memo:E,Portal:u,Profiler:m,StrictMode:d,Suspense:S,isAsyncMode:function(e){return R(e)||z(e)===w},isConcurrentMode:R,isContextConsumer:function(e){return z(e)===y},isContextProvider:function(e){return z(e)===b},isElement:function(e){return"object"===typeof e&&null!==e&&e.$$typeof===h},isForwardRef:function(e){return z(e)===g},isFragment:function(e){return z(e)===f},isLazy:function(e){return z(e)===k},isMemo:function(e){return z(e)===E},isPortal:function(e){return z(e)===u},isProfiler:function(e){return z(e)===m},isStrictMode:function(e){return z(e)===d},isSuspense:function(e){return z(e)===S},isValidElementType:function(e){return"string"===typeof e||"function"===typeof e||e===f||e===v||e===m||e===d||e===S||e===O||"object"===typeof e&&null!==e&&(e.$$typeof===k||e.$$typeof===E||e.$$typeof===b||e.$$typeof===y||e.$$typeof===g||e.$$typeof===j||e.$$typeof===T||e.$$typeof===L||e.$$typeof===P)},typeOf:z},x=(l((function(e,t){0})),l((function(e){e.exports=C})),Object.getOwnPropertySymbols),F=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;function $(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach((function(e){s[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},s)).join("")}catch(a){return!1}})()&&Object.assign;var A="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";function I(e,t,r,s,a){}I.resetWarningCache=function(){0};Function.call.bind(Object.prototype.hasOwnProperty);function N(){}function U(){}U.resetWarningCache=N;var D=l((function(e){e.exports=function(){function e(e,t,r,s,a,o){if(o!==A){var i=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function t(){return e}e.isRequired=e;var r={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:U,resetWarningCache:N};return r.PropTypes=r,r}()}));const W={ERROR_NONE:null,ERROR_GENERIC:"An error occurred while loading this dashboard.",ERROR_PERMISSIONS:"You do not have permissions to view this dashboard."},M={credentials:"same-origin",headers:{"Content-Type":"application/json"}},V={url:D.string.isRequired,user:D.string,tableauTrustedUrl:D.string,filters:D.object,parameters:D.object,onDashboardLoad:D.func},q={tableauTrustedUrl:"/api/tableau/trustedurl",filters:{},onDashboardLoad:()=>{}},Y=window.location.search.indexOf("debug")>-1,H=e=>new Promise((t,r)=>{e.then(e=>{t(e)},e=>{r(e)})});class B extends s.Component{constructor(e){super(e),this.state={maxSize:{},minSize:{},preLoadParams:{},preLoadFilters:{},error:"ERROR_NONE",filters:e.filters,parameters:e.parameters,thirdPartyCookiesEnabled:!0},this.resizeListening=!1,this.resizeEventListener=this.resizeViz.bind(this),this.messageEventListener=this.checkThirdPartyCookies.bind(this)}resizeViz(){if(!this.viz)return;const e=this.container.clientWidth,t=Object.hasOwnProperty.call(this.state.maxSize,"height")?this.state.maxSize.height:"500px";this.viz.setFrameSize(e,t)}checkThirdPartyCookies(e){"ivantage:3PCunsupported"===e.data?(this.setState({thirdPartyCookiesEnabled:!1}),window.removeEventListener("message",this.messageEventListener)):"ivantage:3PCsupported"===e.data&&(this.setState({thirdPartyCookiesEnabled:!0}),window.removeEventListener("message",this.messageEventListener))}getTableau(){if(window.tableau)return Promise.resolve(window.tableau);const e=Date.now();return new Promise((t,r)=>{const s=setInterval(()=>window.tableau?(clearInterval(s),t(window.tableau)):Date.now()-e>6e4?(clearInterval(s),r(new Error("Timed out waiting for Tableau to become available."))):void 0,100)})}getTableauSyncUnsafe(){if(!window.tableau)throw new Error("Accessing window.tableau before it is available");return window.tableau}initTableau(e){this.setState({maxSize:{},minSize:{}});const t=Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)({},this.props),this.state.preLoadParams),this.props.parameters),this.state.preLoadFilters),this.props.filters),{},{hideToolbar:!Y,onFirstInteractive:((e,t)=>()=>{this.workbook=this.viz.getWorkbook(),this.activeSheet=this.workbook.getActiveSheet();const r=this.activeSheet.getSize();this.setState({maxSize:r.maxSize,minSize:r.minSize}),this.resizeListening||(window.addEventListener("resize",this.resizeEventListener),this.resizeListening=!0),this.props.onDashboardLoad(this.workbook),this.setState({filters:t,parameters:e}),Object.keys(this.state.preLoadParams).length&&(this.applyParameters(this.state.preLoadParams),this.setState({preLoadParams:{}})),Object.keys(this.state.preLoadFilters).length&&(this.applyFilters(this.state.preLoadFilters),this.setState({preLoadFilters:{}}))})(this.props.parameters,this.props.filters)});Object.keys(t).forEach(e=>{"undefined"===typeof t[e]&&delete t[e]}),Object.keys(t).forEach(e=>{"object"!==typeof t[e]||Array.isArray(t[e])||delete t[e]}),Y&&(console.log("Creating viz..."),Object.keys(t).filter(e=>"onFirstInteractive"!==e).forEach(e=>{console.log("...with initial option",e,t[e])})),this.viz&&(this.viz.dispose(),this.viz=null,this.workbook=null),this.getTableau().then(r=>{this.viz=new r.Viz(this.container,e,t)}).catch(e=>{console.error(e)})}initTrustedView(){const e=this.props,t=e.url,r=e.user,s=e.tableauTrustedUrl;if(!r){let e=t;return Y&&(e+="&:record_performance=yes&:refresh"),void this.initTableau(e)}fetch("".concat(s,"?user=").concat(r,"&url=").concat(t),M).then(e=>204===e.status?Promise.resolve():e.json().then(r=>{if(e.ok)return r;const s=new Error("Request to ".concat(t," failed with status ").concat(e.status));return s.httpStatusCode=e.status,Promise.reject(s)})).then(e=>{let t="".concat(e.data.id,"&:revert=filters");Y&&(t+="&:record_performance=yes&:refresh"),this.initTableau(t)}).catch(e=>{Object.hasOwnProperty.call(e,"httpStatusCode")&&401===e.httpStatusCode?this.setState({error:"ERROR_PERMISSIONS"}):this.setState({error:"ERROR_GENERIC"}),console.error(e)})}applyFilters(e){if(!this.workbook||!this.viz)return this.setState({preLoadFilters:Object(c.a)(Object(c.a)({},this.state.preLoadFilters),e)});H(this.viz.pauseAutomaticUpdatesAsync()).then(()=>Promise.all(this.applyFiltersHelper(e))).then(()=>H(this.viz.resumeAutomaticUpdatesAsync())).catch(e=>{console.error(e),this.viz.resumeAutomaticUpdatesAsync()})}applyFiltersHelper(e){const t=[],r=this.getTableauSyncUnsafe(),s=[];this.activeSheet instanceof r.Worksheet?s.push(this.activeSheet):Array.prototype.push.apply(s,this.activeSheet.getWorksheets());const a=e=>{s.forEach(s=>t.push(H(s.applyFilterAsync(e,"",r.FilterUpdateType.ALL))))};for(const o in e){const i=e[o];Object.hasOwnProperty.call(this.state.filters,o)&&i===this.state.filters[o]||(Y&&console.log("Setting Tableau filter",o,i,"(was ".concat(this.state.filters[o],")")),i.length?s.forEach(e=>{t.push(H(e.applyFilterAsync(o,i,r.FilterUpdateType.REPLACE)))}):a(o))}for(const o in this.state.filters)Object.hasOwnProperty.call(e,o)||(Y&&console.log("Clearing Tableau filter",o,"(was ".concat(this.state.filters[o],")")),a(o));return this.setState({filters:e}),t}applyParameters(e){if(this.workbook&&this.viz){for(const t in e)Object.hasOwnProperty.call(this.state.parameters,t)&&e[t]===this.state.parameters[t]||(Y&&console.log("Setting Tableau parameter",t,e[t],"(was ".concat(this.state.parameters[t],")")),this.workbook.changeParameterValueAsync(t,e[t]));this.setState({parameters:e})}else this.setState({preLoadParams:Object(c.a)(Object(c.a)({},this.state.preLoadParams),e)})}downloadWorkbook(){this.viz.showDownloadWorkbookDialog()}render(){const e=this.props,t=(e.url,e.user,e.tableauTrustedUrl,e.filters,e.filterTypes,e.parameters,e.onDashboardLoad,Object(n.a)(e,["url","user","tableauTrustedUrl","filters","filterTypes","parameters","onDashboardLoad"]));return a.a.createElement("div",null,a.a.createElement("iframe",{src:"https://ivantage.github.io/3rdpartycookiecheck/start.html",title:"Third-party cookie check",style:{display:"none"}}),!this.state.thirdPartyCookiesEnabled&&a.a.createElement("p",{className:"au-text-warning"},"You need to have third-party cookies enabled in order to view dashboards properly. Please make sure that your browser settings are configured to allow third-party cookies and try refreshing this page."),"ERROR_NONE"!==this.state.error&&a.a.createElement("p",{className:"au-text-warning"},W[this.state.error]),a.a.createElement("div",Object.assign({ref:e=>this.container=e},t)))}componentDidMount(){this.initTrustedView(),window.addEventListener("message",this.messageEventListener)}componentDidUpdate(e){(e.url!==this.props.url||e.user!==this.props.user)&&(this.setState({error:"ERROR_NONE"}),this.initTrustedView())}componentWillReceiveProps(e){const t=e.url===this.props.url,r=e.filters!==this.props.filters||e.filterTypes!==this.props.filterTypes,s=e.parameters!==this.props.parameters;t&&s&&this.applyParameters(e.parameters),t&&r&&this.applyFilters(e.filters,e.filterTypes)}componentWillUnmount(){this.resizeListening&&(window.removeEventListener("resize",this.resizeEventListener),window.removeEventListener("message",this.messageEventListener))}}B.propTypes=V,B.defaultProps=q;var G=B;r(11);var J=()=>a.a.createElement(G,{url:"https://public.tableau.com/views/RegionalSampleWorkbook/College",filters:{"Academic Year":"2013"}});i.a.render(a.a.createElement(J,null),document.getElementById("root"))}],[[5,1,2]]]);
//# sourceMappingURL=main.e99b29b3.chunk.js.map